---
deployment:
  tasks:
    # Log deployment start
    - echo "Starting cPanel deployment for Next.js Node.js app..."
    
    # Set environment to production
    - export NODE_ENV=production
    
    # Install dependencies (including devDependencies for build)
    - npm ci
    
    # Build the Next.js application
    - echo "Building Next.js application..."
    - npm run build
    
    # Clean up devDependencies to save space (optional)
    - npm prune --production
    
    # Set proper file permissions
    - find . -type f -name "*.js" -exec chmod 644 {} \;
    - find . -type f -name "*.json" -exec chmod 644 {} \;
    - find . -type d -exec chmod 755 {} \;
    
    # Log completion
    - echo "Deployment completed. Application ready to start."

# Exclude files/folders from deployment
exclude:
  - node_modules
  - .git
  - .next
  - .env.local
  - .env.development
  - .env.test
  - .DS_Store
  - npm-debug.log*
  - yarn-debug.log*
  - yarn-error.log*
